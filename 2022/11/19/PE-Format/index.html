<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"linjhs.top","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"gitalk","storage":true,"lazyload":false,"nav":{"gitalk":{"order":-2},"valine":{"order":-1}},"activeClass":"gitalk"},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="PE 结构简述 浅浅研究了一下 PE 的结构。 本文归档在这里。">
<meta property="og:type" content="article">
<meta property="og:title" content="PE Format">
<meta property="og:url" content="https://linjhs.top/2022/11/19/PE-Format/index.html">
<meta property="og:site_name" content="LinJHS&#39;s Blog">
<meta property="og:description" content="PE 结构简述 浅浅研究了一下 PE 的结构。 本文归档在这里。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://linjhs.top/2022/11/19/PE-Format/PE_1.png">
<meta property="article:published_time" content="2022-11-19T13:08:56.000Z">
<meta property="article:modified_time" content="2022-11-20T12:00:24.024Z">
<meta property="article:author" content="LinJHS">
<meta property="article:tag" content="CTF">
<meta property="article:tag" content="Reverse">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://linjhs.top/2022/11/19/PE-Format/PE_1.png">

<link rel="canonical" href="https://linjhs.top/2022/11/19/PE-Format/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>PE Format | LinJHS's Blog</title>
  


  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?11b963ee84ebb5c20c246493f697e975";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><link rel="alternate" href="/rss.xml" title="LinJHS's Blog" type="application/rss+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">LinJHS's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-docs">

    <a href="https://docs.linjhs.top/" rel="noopener" target="_blank"><i class="fa fa-file fa-fw"></i>文档</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://linjhs.top/2022/11/19/PE-Format/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="LinJHS">
      <meta itemprop="description" content="This is LinJHS's blog">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LinJHS's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          PE Format
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-11-19 21:08:56" itemprop="dateCreated datePublished" datetime="2022-11-19T21:08:56+08:00">2022-11-19</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-11-20 20:00:24" itemprop="dateModified" datetime="2022-11-20T20:00:24+08:00">2022-11-20</time>
              </span>

          
            <span id="/2022/11/19/PE-Format/" class="post-meta-item leancloud_visitors" data-flag-title="PE Format" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2022/11/19/PE-Format/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/11/19/PE-Format/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="pe-结构简述"><a class="markdownIt-Anchor" href="#pe-结构简述"></a> PE 结构简述</h1>
<p>浅浅研究了一下 PE 的结构。</p>
<p>本文归档在<a target="_blank" rel="noopener" href="https://docs.linjhs.top/ctf/re/05/">这里</a>。</p>
<span id="more"></span>
<h2 id="pe-简介"><a class="markdownIt-Anchor" href="#pe-简介"></a> PE 简介</h2>
<p>PE 文件的全称是 Portable Executable ，意为可移植的可执行的文件，常见的 EXE、DLL、OCX、SYS、COM 都是 PE 文件，PE 文件是微软 Windows 操作系统上的程序文件（可能是间接被执行，如 DLL ）。</p>
<h2 id="pe-结构概述"><a class="markdownIt-Anchor" href="#pe-结构概述"></a> PE 结构概述</h2>
<p>PE 文件大致可以分为两部分，即数据管理结构及数据部分。</p>
<ol>
<li>数据管理结构包含：<strong>DOS 头、PE 头、节表</strong>。</li>
<li>数据部分包括：<strong>节表数据</strong>（节表数据是包含着代码、数据等内容）。</li>
</ol>
<p><img src="PE_1.png" alt="PE 结构" /></p>
<h2 id="数据管理结构"><a class="markdownIt-Anchor" href="#数据管理结构"></a> 数据管理结构</h2>
<h3 id="01-dos-头"><a class="markdownIt-Anchor" href="#01-dos-头"></a> 01 DOS 头</h3>
<p>所有的 PE 文件都是以一个 64 字节的 DOS 程序开始。当 PE 文件在 DOS 下执行时，DOS 可以识别出这是一个有效的执行体，然后运行 DOS Stub 。这个 DOS 头只是为了兼容早期的 DOS 操作系统。不需要详细了解。</p>
<p><strong>DOS HEADER</strong> 和 <strong>DOS Stub</strong> 合称为 DOS 文件头。</p>
<p>PE 文件前 <code>0x40</code> 个字节是一个传统的 DOS 头，结构为 <code>IMAGE_DOS_HEADER</code> 。如果在 DOS 中执行文件，则会调用存根程序（DOS Stub）。 它通常显示合适的消息；但是，任何有效的 DOS 应用程序都可以是存根程序。</p>
<p>winn.h 中定义:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> IMAGE_DOS_SIGNATURE 0x5A4D      <span class="comment">// MZ</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">IMAGE_DOS_HEADER</span> &#123;</span>      <span class="comment">// DOS .EXE header</span></span><br><span class="line">    WORD   e_magic;                     <span class="comment">// Magic number</span></span><br><span class="line">    WORD   e_cblp;                      <span class="comment">// Bytes on last page of file</span></span><br><span class="line">    WORD   e_cp;                        <span class="comment">// Pages in file</span></span><br><span class="line">    WORD   e_crlc;                      <span class="comment">// Relocations</span></span><br><span class="line">    WORD   e_cparhdr;                   <span class="comment">// Size of header in paragraphs</span></span><br><span class="line">    WORD   e_minalloc;                  <span class="comment">// Minimum extra paragraphs needed</span></span><br><span class="line">    WORD   e_maxalloc;                  <span class="comment">// Maximum extra paragraphs needed</span></span><br><span class="line">    WORD   e_ss;                        <span class="comment">// Initial (relative) SS value</span></span><br><span class="line">    WORD   e_sp;                        <span class="comment">// Initial SP value</span></span><br><span class="line">    WORD   e_csum;                      <span class="comment">// Checksum</span></span><br><span class="line">    WORD   e_ip;                        <span class="comment">// Initial IP value</span></span><br><span class="line">    WORD   e_cs;                        <span class="comment">// Initial (relative) CS value</span></span><br><span class="line">    WORD   e_lfarlc;                    <span class="comment">// File address of relocation table</span></span><br><span class="line">    WORD   e_ovno;                      <span class="comment">// Overlay number</span></span><br><span class="line">    WORD   e_res[<span class="number">4</span>];                    <span class="comment">// Reserved words</span></span><br><span class="line">    WORD   e_oemid;                     <span class="comment">// OEM identifier (for e_oeminfo)</span></span><br><span class="line">    WORD   e_oeminfo;                   <span class="comment">// OEM information; e_oemid specific</span></span><br><span class="line">    WORD   e_res2[<span class="number">10</span>];                  <span class="comment">// Reserved words</span></span><br><span class="line">    LONG   e_lfanew;                    <span class="comment">// File address of new exe header</span></span><br><span class="line">&#125; IMAGE_DOS_HEADER, *PIMAGE_DOS_HEADER;</span><br></pre></td></tr></table></figure>
<p>重要字段:</p>
<ol>
<li>e_magic -&gt; DOS 头的标识，为 <code>0x4D</code> 和 <code>0x5A</code> 。分别为字母 <code>MZ</code> 。</li>
<li>e_lfanew -&gt; 一个双字数据，为 exe 头的文件地址。 Windows 加载器通过它可以跳过 DOS Stub 部分直接找到 PE 头。</li>
</ol>
<p>DOS 头后跟一个 DOS Stub 数据，是链接器链接执行文件的时候加入的部分数据，一般是“This program cannot be run in DOS mode.”。这个可以通过修改链接器的设置来修改成自己定义的数据。</p>
<h3 id="02-pe-头nt-头结构"><a class="markdownIt-Anchor" href="#02-pe-头nt-头结构"></a> 02 PE 头（NT 头）结构</h3>
<p>PE 头分为三个部分，分别是 <strong>PE 标识</strong>（IMAGE_NT_SIGNATRUE）、<strong>映像文件头</strong>（IMAGE_FILE_HEADER）、<strong>可选映像头</strong>（IMAHE_OPTION_HEADER）。PE 头是固定不变的，位于 DOS 头部中 e_ifanew 字段指出位置。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//x86</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">IMAGE_NT_HEADERS</span> &#123;</span></span><br><span class="line">    DWORD Signature;</span><br><span class="line">    IMAGE_FILE_HEADER FileHeader;</span><br><span class="line">    IMAGE_OPTIONAL_HEADER32 OptionalHeader;</span><br><span class="line">&#125; IMAGE_NT_HEADERS32, *PIMAGE_NT_HEADERS32;</span><br><span class="line"><span class="comment">//x64</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">IMAGE_NT_HEADERS</span> &#123;</span></span><br><span class="line">    DWORD Signature;</span><br><span class="line">    IMAGE_FILE_HEADER FileHeader;</span><br><span class="line">    IMAGE_OPTIONAL_HEADER64 OptionalHeader;</span><br><span class="line">&#125; IMAGE_NT_HEADERS64, *PIMAGE_NT_HEADERS64;</span><br></pre></td></tr></table></figure>
<p>其中，<code>Signature</code> 为 <code>0x00004550</code> ，即字符串 <code>&quot;PE\0\0&quot;</code></p>
<p>接下来是 <strong>映像文件头</strong>（FileHeader）：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">IMAGE_FILE_HEADER</span> &#123;</span></span><br><span class="line">    WORD    Machine;              <span class="comment">// 运行平台，cpu类型</span></span><br><span class="line">    WORD    NumberOfSections;     <span class="comment">// 文件的区块数（SectionTable 项的数量）</span></span><br><span class="line">    DWORD   TimeDateStamp;        <span class="comment">// 时间戳，文件创建日期与时间</span></span><br><span class="line">    DWORD   PointerToSymbolTable; <span class="comment">// 指向符号表（用于调试）</span></span><br><span class="line">    DWORD   NumberOfSymbols;      <span class="comment">// 符号表中符号的个数（用于调试）</span></span><br><span class="line">    WORD    SizeOfOptionalHeader; <span class="comment">// IMAGE_OPTIONAL_HEADER 结构大小</span></span><br><span class="line">    WORD    Characteristics;      <span class="comment">// 文件属性</span></span><br><span class="line">&#125; IMAGE_FILE_HEADER, *PIMAGE_FILE_HEADER;</span><br></pre></td></tr></table></figure>
<p>重要字段：</p>
<ol>
<li>NumberOfSections：定义 PE 文件 Section 的个数。如果对 PE 文件新增或删除 Section 的话，一定要记的修改此域。</li>
<li>SizeOfOptionalHeader：定义 OptionHeader 结构的大小。</li>
<li>Characteristics：主要用来标识当前的 PE 文件是执行文件还是 DLL 。其各位都有具体的含义。</li>
</ol>
<p>其中 Characteristics 字段：</p>
<table>
<thead>
<tr>
<th>宏定义</th>
<th>值</th>
<th>意义</th>
</tr>
</thead>
<tbody>
<tr>
<td>IMAGE_FILE_RELOCS_STRIPPED</td>
<td><code>0x0001</code></td>
<td>文件中不存在重定位信息</td>
</tr>
<tr>
<td>IMAGE_FILE_EXECUTABLE_IMAGE</td>
<td><code>0x0002</code></td>
<td>文件是可执行的</td>
</tr>
<tr>
<td>IMAGE_FILE_LINE_NUMS_STRIPPED</td>
<td><code>0x0004</code></td>
<td>不存在行信息</td>
</tr>
<tr>
<td>IMAGE_FILE_LOCAL_SYMS_STRIPPED</td>
<td><code>0x0008</code></td>
<td>不存在符号信息</td>
</tr>
<tr>
<td>IMAGE_FILE_BYTES_REVERSED_LO</td>
<td></td>
<td>小尾方式</td>
</tr>
<tr>
<td>IMAGE_FILE_32BIT_MACHINE</td>
<td><code>0x0100</code></td>
<td>只在 32 位平台运行</td>
</tr>
<tr>
<td>IMAGE_FILE_DEBUG_STRIPPED</td>
<td></td>
<td>不包含调试信息</td>
</tr>
<tr>
<td>IMAGE_FILE_REMOVABLE_RUN_FROM_SWAP</td>
<td></td>
<td>不能从可移动盘运行</td>
</tr>
<tr>
<td>IMAGE_FILE_NET_RUN_FROM_SWAP</td>
<td></td>
<td>不能从网络运行</td>
</tr>
<tr>
<td>IMAGE_FILE_SYSTEM</td>
<td><code>0x2000</code></td>
<td>系统文件。不能直接运行</td>
</tr>
<tr>
<td>IMAGE_FILE_DLL</td>
<td><code>0x1000</code></td>
<td>DLL 文件</td>
</tr>
<tr>
<td>IMAGE_FILE_UP_SYSTEM_ONLY</td>
<td></td>
<td>文件不能在多处理器上运行</td>
</tr>
<tr>
<td>IMAGE_FILE_BYTES_REVERSED_HI</td>
<td></td>
<td>大尾方式</td>
</tr>
</tbody>
</table>
<p>接着是 <strong>可选映像头</strong>（OptionalHeader）</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//x86</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">IMAGE_OPTIONAL_HEADER</span> &#123;</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">// Standard fields.</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    WORD    Magic;                  <span class="comment">//标志字</span></span><br><span class="line">    BYTE    MajorLinkerVersion;     <span class="comment">//链接器主版本号</span></span><br><span class="line">    BYTE    MinorLinkerVersion;     <span class="comment">//链接器次版本号</span></span><br><span class="line">    DWORD   SizeOfCode;             <span class="comment">//所有含有代码的区块大小*</span></span><br><span class="line">    DWORD   SizeOfInitializedData;  <span class="comment">//所有初始化数据区块的大小</span></span><br><span class="line">    DWORD   SizeOfUninitializedData;<span class="comment">//所有未初始化数据区块的大小</span></span><br><span class="line">    DWORD   AddressOfEntryPoint;    <span class="comment">//程序执行入口 RVA*</span></span><br><span class="line">    DWORD   BaseOfCode;             <span class="comment">//代码区块起始 RVA*</span></span><br><span class="line">    DWORD   BaseOfData;             <span class="comment">//数据区块起始 RVA</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">// NT additional fields.</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    DWORD   ImageBase;              <span class="comment">//程序默认载入基址*</span></span><br><span class="line">    DWORD   SectionAlignment;       <span class="comment">//内存中区块的对齐值*</span></span><br><span class="line">    DWORD   FileAlignment;          <span class="comment">//文件中区块的对齐值*</span></span><br><span class="line">    WORD    MajorOperatingSystemVersion; <span class="comment">//操作系统主版本号</span></span><br><span class="line">    WORD    MinorOperatingSystemVersion; <span class="comment">//操作系统次版本号</span></span><br><span class="line">    WORD    MajorImageVersion;      <span class="comment">//用户自定义主版本号</span></span><br><span class="line">    WORD    MinorImageVersion;      <span class="comment">//用户自定义次版本号</span></span><br><span class="line">    WORD    MajorSubsystemVersion;  <span class="comment">//所需子系统主版本号</span></span><br><span class="line">    WORD    MinorSubsystemVersion;  <span class="comment">//所需子系统次版本号</span></span><br><span class="line">    DWORD   Win32VersionValue;      <span class="comment">//保留，通常被设置为 0</span></span><br><span class="line">    DWORD   SizeOfImage;            <span class="comment">//映像载入内存后的总尺寸*</span></span><br><span class="line">    DWORD   SizeOfHeaders;          <span class="comment">//DOS 头、PE 文件头、区块表总大小*</span></span><br><span class="line">    DWORD   CheckSum;               <span class="comment">//映像校验和</span></span><br><span class="line">    WORD    Subsystem;              <span class="comment">//文件子系统</span></span><br><span class="line">    WORD    DllCharacteristics;     <span class="comment">//显示 DLL 特性的旗标</span></span><br><span class="line">    DWORD   SizeOfStackReserve;     <span class="comment">//初始化时栈的大小*</span></span><br><span class="line">    DWORD   SizeOfStackCommit;      <span class="comment">//初始化时实际提交栈的大小*</span></span><br><span class="line">    DWORD   SizeOfHeapReserve;      <span class="comment">//初始化时保留堆的大小*</span></span><br><span class="line">    DWORD   SizeOfHeapCommit;       <span class="comment">//初始化时实际保留堆的大小*</span></span><br><span class="line">    DWORD   LoaderFlags;            <span class="comment">//与调试相关，默认值为0</span></span><br><span class="line">    DWORD   NumberOfRvaAndSizes;    <span class="comment">//数据目录表的项数*</span></span><br><span class="line">    IMAGE_DATA_DIRECTORY DataDirectory[IMAGE_NUMBEROF_DIRECTORY_ENTRIES];</span><br><span class="line">&#125; IMAGE_OPTIONAL_HEADER32, *PIMAGE_OPTIONAL_HEADER32;</span><br><span class="line"><span class="comment">//x64</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">IMAGE_OPTIONAL_HEADER64</span> &#123;</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">// Standard fields.</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    WORD        Magic;</span><br><span class="line">    BYTE        MajorLinkerVersion;</span><br><span class="line">    BYTE        MinorLinkerVersion;</span><br><span class="line">    DWORD       SizeOfCode;</span><br><span class="line">    DWORD       SizeOfInitializedData;</span><br><span class="line">    DWORD       SizeOfUninitializedData;</span><br><span class="line">    DWORD       AddressOfEntryPoint;</span><br><span class="line">    DWORD       BaseOfCode;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">// NT additional fields.</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    ULONGLONG   ImageBase;</span><br><span class="line">    DWORD       SectionAlignment;</span><br><span class="line">    DWORD       FileAlignment;</span><br><span class="line">    WORD        MajorOperatingSystemVersion;</span><br><span class="line">    WORD        MinorOperatingSystemVersion;</span><br><span class="line">    WORD        MajorImageVersion;</span><br><span class="line">    WORD        MinorImageVersion;</span><br><span class="line">    WORD        MajorSubsystemVersion;</span><br><span class="line">    WORD        MinorSubsystemVersion;</span><br><span class="line">    DWORD       Win32VersionValue;</span><br><span class="line">    DWORD       SizeOfImage;</span><br><span class="line">    DWORD       SizeOfHeaders;</span><br><span class="line">    DWORD       CheckSum;</span><br><span class="line">    WORD        Subsystem;</span><br><span class="line">    WORD        DllCharacteristics;</span><br><span class="line">    ULONGLONG   SizeOfStackReserve;</span><br><span class="line">    ULONGLONG   SizeOfStackCommit;</span><br><span class="line">    ULONGLONG   SizeOfHeapReserve;</span><br><span class="line">    ULONGLONG   SizeOfHeapCommit;</span><br><span class="line">    DWORD       LoaderFlags;</span><br><span class="line">    DWORD       NumberOfRvaAndSizes;</span><br><span class="line">    IMAGE_DATA_DIRECTORY DataDirectory[IMAGE_NUMBEROF_DIRECTORY_ENTRIES];</span><br><span class="line">&#125; IMAGE_OPTIONAL_HEADER64, *PIMAGE_OPTIONAL_HEADER64;</span><br></pre></td></tr></table></figure>
<p>对比 winnt.h 中定义的 32 位 PE 文件头与 64 位 PE 文件头，可以发现两者的区别在 <code>IMAGE_OPTIONAL_HEADER</code> ，其中有 6 处不同（以 64 位 PE 文件头说明）：</p>
<ol>
<li>移除了 <code>DWORD BaseOfData</code>字段</li>
<li>以下 5 个字段类型由 <code>DWORD</code> 更改为了 <code>ULONGLONG</code></li>
</ol>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ULONGLONG   ImageBase;</span><br><span class="line">ULONGLONG   SizeOfStackReserve;</span><br><span class="line">ULONGLONG   SizeOfStackCommit;</span><br><span class="line">ULONGLONG   SizeOfHeapReserve;</span><br><span class="line">ULONGLONG   SizeOfHeapCommit;</span><br></pre></td></tr></table></figure>
<p>重要字段：</p>
<ol>
<li>
<p>SizeOfCode：有 IMAGE_SCN_NT_CODE 属性的区块的总大小，该字段与 .text 块的大小匹配</p>
</li>
<li>
<p>AddressOfEntryPoint：程序执行入口 RVA</p>
<p><em>注：RVA 相对虚拟偏移</em></p>
<p>对于 DLL ，这个入口点在进程初始化和关闭时及线程创建和结束时被调用。在大多数可执行文件中，这个地址不直接指向 Main、WinMain 或 DllMain 函数，而指向运行时的库代码（ntdll_RtlUserThreadStart）并由它来调用上述函数。在 DLL 中，链接器的 /NOENTRY 开关可以设置这个域为 0 。</p>
</li>
<li>
<p>BaseOfCode：代码段的起始 RVA 。代码段通常位于PE文件头之后,数据块之前</p>
</li>
<li>
<p>ImageBase：</p>
<p>文件在内存中的首选载入地址。如果有可能（也就是说，如果目前没有其他文件占据这块地址，它就是正确对齐的并且是一个合法的地址），加载器会试图在这个地址载入 PE 文件。</p>
<p>如果 PE 文件是在这个地址载入的，那么加载器将跳过应用基址重定位的步骤。如果该地址被占用，加载器会选用其它地址作为载入地址，然后执行应用基址重定位的步骤</p>
</li>
<li>
<p>SectionAlignment：载入内存时的区块对齐大小 / 内存中区块的对齐大小。最小对齐尺寸为每页 <code>0x1000 (4kb)</code> 。</p>
</li>
<li>
<p>FileAlignment：磁盘上 PE 文件的区块对齐大小。该值为 2 的幂，且最小值为 <code>0x200(512b)</code> 。</p>
</li>
<li>
<p>SizeOfImage：映像载入内存后的总尺寸。</p>
</li>
<li>
<p>SizeOfHeaders：DOS 头、PE 文件头、区块表的总尺寸</p>
</li>
<li>
<p>SizeOfStackReserve：在 EXE 文件里为线程保留的栈的大小</p>
</li>
<li>
<p>SizeOfStackCommit：在 EXE 文件里，一开始即被委派给栈的内存，默认值为 <code>0x1000(4kb)</code></p>
</li>
<li>
<p>SizeOfHeapReserve：在 EXE 文件里，为进程默认堆保留的内存，默认值为 <code>0x100000(1MB)</code></p>
</li>
<li>
<p>SizeOfHeapCommit：在 EXE 文件里，委派给堆的内存，默认值 <code>0x1000(4kb)</code></p>
</li>
<li>
<p>CheckSum：映像的校验和。IMACEHLP.DLL 中的 <code>CheckSumMappedFile</code> 函数可以计算该值。一般的 EXE 文件该值可以是 0 ，但一些内核模式的驱动程序和系统 DLL 必须有一个校验和。当链接器的 <code>/RELEASE</code> 开关被使用时，校验和被置于文件中。</p>
</li>
</ol>
<p>最后 128 个字节为数据目录（Data Directory）。它由 16 个<code>IMAGE_DATA_DIRECTORY</code> 结构组成的数组构成，指向输出表、输入表、资源块、重定位等数据目录项的 RVA（相对虚拟地址）和大小。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">IMAGE_DATA_DIRECTORY</span> &#123;</span></span><br><span class="line">    DWORD   VirtualAddress; <span class="comment">//数据块的起始 RVA</span></span><br><span class="line">    DWORD   Size;           <span class="comment">//数据块的长度</span></span><br><span class="line">&#125; IMAGE_DATA_DIRECTORY, *PIMAGE_DATA_DIRECTORY;</span><br></pre></td></tr></table></figure>
<p>数据目录项是<strong>可选</strong>的，并不是所有的数据目录项都会有值。数据目录项包括：输入表、输出表、资源、例外、安全、重定位、调试、版权、全局指针、Tls 表、载入配制、输入范围、IAT、延迟输入、COM、保留 共十六个项。</p>
<h3 id="03-节表区块表"><a class="markdownIt-Anchor" href="#03-节表区块表"></a> 03 节表（区块表）</h3>
<p>在 PE 文件头与原始数据之间存在一个区块表（Section Table），它是一个 IMAGE_SECTION_HEADER 结构数组，区块表包含每个块在映像中的信息（如位置、长度、属性），分别指向不同的区块实体。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">IMAGE_SECTION_HEADER</span> &#123;</span></span><br><span class="line">    Name                        <span class="comment">//8 个字节的块名</span></span><br><span class="line">    <span class="class"><span class="keyword">union</span></span></span><br><span class="line"><span class="class">    &#123;</span></span><br><span class="line">        DWORD PhysicalAddress;</span><br><span class="line">        DWORD VirtualSize;</span><br><span class="line">    &#125; Misc;                     <span class="comment">//区块尺寸</span></span><br><span class="line">    DWORD VirtualAddress        <span class="comment">//区块的 RVA 地址</span></span><br><span class="line">    DWORD SizeOfRawData;        <span class="comment">//在文件中对齐后的尺寸</span></span><br><span class="line">    DWORD PointerToRawData;     <span class="comment">//在文件中偏移</span></span><br><span class="line">    DWORD PointerToRelocations; <span class="comment">//在 OBJ 文件中使用，重定位的偏移</span></span><br><span class="line">    DWORD PointerToLinenumbers; <span class="comment">//行号表的偏移（供调试使用地）</span></span><br><span class="line">    WORD NumberOfRelocations;   <span class="comment">//在 OBJ 文件中使用，重定位项数目</span></span><br><span class="line">    WORD NumberOfLinenumbers;   <span class="comment">//行号表中行号的数目</span></span><br><span class="line">    DWORD Characteristics;      <span class="comment">//区块属性，如可读，可写，可执行等</span></span><br><span class="line">&#125; IMAGE_SECTION_HEADER, *PIMAGE_SECTION_HEADER;</span><br></pre></td></tr></table></figure>
<p>一个 PE 文件至少需要两个 Section ，一个是存放代码，一个存放数据。NT 上的 PE 文件基本上有 9 个预定义的 Section 。分别是：.text ，.bss ，.rdata ，.data ，.rsrc ，.edata ，.idata ，.pdata 和 .debug 。一些 PE 文件中只需要其中的一部分区块。</p>
<p>重要字段：</p>
<ol>
<li>
<p>Name：块名，这是一个 8 位 ASCII 码名，用来定义块名。多数块名以一个 &quot;.&quot; 开始（如 .text），尽管许多 PE 文档都认为这个 &quot;.&quot; 实际上并不是必须的。值得注意的是，如果块名超过 8 位，则最后的 NULL 不存在。带有一个 &quot;$&quot; 的区块名字会从链接器那里得到特殊的对待，前面带 &quot;$&quot; 的相同名字的区块被合并，在合并后的区块中它们是按 &quot;$&quot; 后面的字符字母顺序进行合并的。</p>
<p>常见区块与区块合并</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>.text</td>
<td>默认的代码区块，它的内容全是指令代码。PE 文件运行在 32 位方式下，不受 16 位段的约束，所以没有理由把代码放到不同的区块中。链接器把所有目标文件的 .text 块链接成一个大的 .text 块。如果使用 Borland C++ ，其编译器将产生的代码存储于名为 code 的区域，其链接器链接的结果是使代码块的名称不是 .text ，而是 code</td>
</tr>
<tr>
<td>.data</td>
<td>磨人的读 / 写数据区块。全局变量，静态变量一般放在这里。</td>
</tr>
<tr>
<td>.rdata</td>
<td>默认的只读数据区块，但程序很少用到该块中的数据，至少有两种情况要用到 .rdata 块。一是在 Microsoft 链接器产生的 EXE 文件中，用于存放调试目录；二是用于存放说明字符串。如果程序的 DEF 文件中指定了 DESCRIPTION . 字符串就会出现在 .rdata 块中</td>
</tr>
<tr>
<td>.idata</td>
<td>包含其他外来 DLL 的函数及数据信息，即输入表。将 .idata 区块合并到另一个区块已成为惯例，典型的是 .rdata 区块。链接器默认仅在创建一个 Release 模式的可执行文件时才将 .idata 区块合并到另一个区块中</td>
</tr>
<tr>
<td>.edata</td>
<td>输出表。当创建一个输出 API 或数据的可执行文件时，链接器会创建一个 .EXP 文件，这个 .EXP 文件包含一个 .edata 区块，它会被加入最后的可执行文件中。与 .idata 区块一样，.edata 区块也经常被发现合并到了 .text 或 .tdata 区块中</td>
</tr>
<tr>
<td>.rsrc</td>
<td>资源，包括模块的全部资源，例如图标、菜单、位图等。这个区块是只读的，无论如何都不应该命名为 .rsrc 以外的名字，也不能被合并到其他区块里</td>
</tr>
<tr>
<td>.bss</td>
<td>未初始化数据。很少使用，取而代之的是执行文件的 .data 区块的 VirtualSize 被扩展到足够大以存放未初始化的数据</td>
</tr>
<tr>
<td>.crt</td>
<td>用于支持 C++ 运行时（CRT）所添加的数据</td>
</tr>
<tr>
<td>.tls</td>
<td>TLS 的意思是线程局部存储器，用于支持通过 __declspec（thread）声明的线程局部存储变量的数据，既包括数据的初始化值，也包括运行时所需要的额外变量。</td>
</tr>
<tr>
<td>.reloc</td>
<td>可执行文件的基址重定位。基址重定位一般只是 DLL 需要，而不是 EXE 需要。在 Release 模式下，链接器不会给 EXE 文件加上基址重定位，重定位可以在链接时通过 /FIXED 开关关闭</td>
</tr>
<tr>
<td>.sdata</td>
<td>相对于全局指针的可被定位的“短的”读/写数据，用于 IA-64 和其他使用一个全局指针寄存器的体系结构。IA-64 上的常规大小的全局变量放在这个区块里</td>
</tr>
<tr>
<td>.srdata</td>
<td>相对于全局指针的可被定义的“短的”只读数据，用于 IA-64 和其他使用一个全局指针寄存器的体系结构。</td>
</tr>
<tr>
<td>.pdata</td>
<td>异常表，包含一个 CPU 特定的 IMAGE_RUNTIME_FUNCTION_ENTRY 结构数组，DataDirectory 中的 IMAGE_DIRECTORY_ENTRY_EXCEPTION 指向它。它用于异常处理，是基于表的体系结构，就像 IA-64 。唯一不使用基于表的异常处理的架构体系是 x86</td>
</tr>
<tr>
<td>.debugSS</td>
<td>OBJ 文件中 Codeview 格式的符号。这是一个变量长度的 Codeview 格式的符号记录流</td>
</tr>
<tr>
<td>.debugST</td>
<td>OBJ 文件中 Codeview 格式的类型记录。这是一个变量长度的 Codeview 格式的类型记录流</td>
</tr>
<tr>
<td>.debugSP</td>
<td>当时用预编译的头时，可以在 OBJ 文件中找到它</td>
</tr>
<tr>
<td>.drectve</td>
<td>包含连接器命令，只能在 OBJ 中找到它。命令是能被传递给连接器命令行的字符串，例如“-defaultlib:LIBC”。命令用空格字符分开</td>
</tr>
<tr>
<td>.didat</td>
<td>延迟载入的输入数据，只能在非 Release 模式的可执行文件中找到。在 Release 模式下，延迟载入的数据会被合并到另一个区块中</td>
</tr>
</tbody>
</table>
<p>可以通过声明，将数据插入自定义的区块，而不是默认的区块。</p>
<p>链接器的工作是合并所有 OBJ 和库中所有的块，使其最终成为一个合适的区块。OBJ 文件中还可以存在一个放置链接信息的区块，链接完即删除掉。</p>
<p>区块合并没有什么硬性规定，把 .rdata 合并到 .text 不会有什么问题。但不应将 .rsrc 、.reloc 或 .pdata 合并到其他区块里。</p>
</li>
<li>
<p>Misc.VirtualSize：指出实际的、被使用的区块大小。如果 VirtualSize 大于 SizeOfRawData ，那么 SizeOfRawData（来自于可执行文件初始化数据的大小）与 VirtualSize 相差的字节用 <code>0</code> 填充。这个字段在 OBJ 文件中设为 <code>0</code> 。</p>
</li>
<li>
<p>VirtualAddress：该块装载到内存中的 RVA 。这个地址是按照内存页对齐的，它的数值总是 SectionAlignment 的整数倍。在 MS 工具中，第一块的默认 RVA 为 <code>0x1000</code> 。在 OBJ 中，该字段没意义。如果该值为 <code>0x1000</code> ，PE 文件被加载到 <code>0x400000</code> ，那么该 Section 的起始地址为 <code>0x401000</code> 。</p>
</li>
<li>
<p>SizeOfRawData：该块在磁盘文件中所占的大小。在可执行文件中，这个值必须是 PE 头部指定的文件对齐大小的倍数。如果是 <code>0</code> ，则说明区块中的数据是未初始化的。该块在磁盘文件中所占的大小，这个数值等于 VirtualSize 字段的值按照 FileAlignment 的值对齐以后的大小。例如，FileAlignment的大小为 <code>0x1000</code> ，如果 VirtualSize 中的块长度为 <code>0x2911</code> ，则 SizeOfRawData 为 <code>0x3000</code> 。</p>
</li>
<li>
<p>PointerToRawData：该块在磁盘文件中的偏移。对于可执行文件，这个值必须是 PE 头部指定的文件对齐大小的倍数。</p>
</li>
<li>
<p>PointerToRelocations：这部分在 EXE 文件中无意义。在 OBJ 文件中，表示本块重定位信息的偏移量。在 OBJ 文件中如果不是零，则会指向一个 IMAGE_RELOCATION 的数据结构。</p>
</li>
<li>
<p>NumberOfRelocations：由 PointerToRelocations 指向的重定位的数目。</p>
</li>
<li>
<p>NumberOfLinenumbers：由 NumberOfRelocations 指向的行号的数目，只在 COFF 样式的行号被指定时使用。</p>
</li>
<li>
<p>Characteristics：块属性，该字段是一组指出块属性（如代码/数据/可读/可写等）的标志。多个标志值通过 OR 操作形成 Characteristics 的值。这些标志很多都可以通过链接器 <code>/SECTION</code> 选项设置。</p>
</li>
</ol>
<p>PE 文件常见的区块：</p>
<table>
<thead>
<tr>
<th>中文名</th>
<th>命名</th>
</tr>
</thead>
<tbody>
<tr>
<td>执行代码段</td>
<td>.text（Microsoft）/ CODE（Borland）</td>
</tr>
<tr>
<td>数据段</td>
<td>.data（全局变量等） / .rdata（只读数据） / .bss（Microsoft，未初始化的数据）/ DATA（Borland）</td>
</tr>
<tr>
<td>资源段</td>
<td>.rsrc（资源树的结构存放）</td>
</tr>
<tr>
<td>导出表</td>
<td>.edata</td>
</tr>
<tr>
<td>导入表</td>
<td>.idata</td>
</tr>
<tr>
<td>调试信息段</td>
<td>.debug</td>
</tr>
</tbody>
</table>
<p><em>注 1：.pdata 帮助在运行时进行堆栈遍历。此结构有助于调试和异常处理。</em></p>
<p><em>注 2：这些区块并不是都是必须的，当然，也可以根据需要定义更多的区块（比如一些加壳程序）。</em></p>
<h2 id="数据部分区块节"><a class="markdownIt-Anchor" href="#数据部分区块节"></a> 数据部分——区块（节）</h2>
<p>累了，不研究了。就到这里吧。</p>
<hr />
<p>参考资料：</p>
<ol>
<li>pe文件 <a target="_blank" rel="noopener" href="https://baike.baidu.com/item/pe%E6%96%87%E4%BB%B6/6488140">https://baike.baidu.com/item/pe文件/6488140</a></li>
<li>PE Format <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/windows/win32/debug/pe-format">https://learn.microsoft.com/en-us/windows/win32/debug/pe-format</a></li>
<li>PE结构详解（加壳脱壳必备知识）<a target="_blank" rel="noopener" href="https://blog.csdn.net/a59a59/article/details/103214936">https://blog.csdn.net/a59a59/article/details/103214936</a></li>
<li>PE文件结构详解精华 <a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_43655282/article/details/104291312">https://blog.csdn.net/weixin_43655282/article/details/104291312</a></li>
<li>深入剖析PE文件 <a target="_blank" rel="noopener" href="https://developer.aliyun.com/article/492435">https://developer.aliyun.com/article/492435</a></li>
<li>PDATA Structures (Windows CE 5.0) <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/previous-versions/windows/embedded/aa448751(v=msdn.10)">https://learn.microsoft.com/en-us/previous-versions/windows/embedded/aa448751(v=msdn.10)</a></li>
<li>加密与解密 - 11.2 MS-DOS头 <a target="_blank" rel="noopener" href="https://blog.csdn.net/qq726232111/article/details/112568763">https://blog.csdn.net/qq726232111/article/details/112568763</a></li>
<li>加密与解密 - 11.3 PE文件头 <a target="_blank" rel="noopener" href="https://blog.csdn.net/qq726232111/article/details/112605738">https://blog.csdn.net/qq726232111/article/details/112605738</a></li>
<li>第11章：PE 文件格式（补充） <a target="_blank" rel="noopener" href="https://www.cnblogs.com/Rev-omi/p/14118993.html">https://www.cnblogs.com/Rev-omi/p/14118993.html</a></li>
<li>PE知识复习之PE的RVA与FOA的转换 <a target="_blank" rel="noopener" href="https://www.lmlphp.com/user/56/article/item/87/">https://www.lmlphp.com/user/56/article/item/87/</a></li>
</ol>

    </div>

    
    
    
        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>LinJHS
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://linjhs.top/2022/11/19/PE-Format/" title="PE Format">https://linjhs.top/2022/11/19/PE-Format/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/zh-CN" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/CTF/" rel="tag"># CTF</a>
              <a href="/tags/Reverse/" rel="tag"># Reverse</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2022/11/19/My-First-Manual-Dump/" rel="prev" title="My First Manual Dump">
      <i class="fa fa-chevron-left"></i> My First Manual Dump
    </a></div>
      <div class="post-nav-item">
    <a href="/2022/11/21/ELF-Format/" rel="next" title="ELF Format">
      ELF Format <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
      <div class="tabs tabs-comment">
        <ul class="nav-tabs">
            <li class="tab"><a href="#comment-gitalk">gitalk</a></li>
            <li class="tab"><a href="#comment-valine">valine</a></li>
        </ul>
        <div class="tab-content">
            <div class="tab-pane gitalk" id="comment-gitalk">
              <div class="comments" id="gitalk-container"></div>
            </div>
            <div class="tab-pane valine" id="comment-valine">
              <div class="comments" id="valine-comments"></div>
            </div>
        </div>
      </div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#pe-%E7%BB%93%E6%9E%84%E7%AE%80%E8%BF%B0"><span class="nav-number">1.</span> <span class="nav-text"> PE 结构简述</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#pe-%E7%AE%80%E4%BB%8B"><span class="nav-number">1.1.</span> <span class="nav-text"> PE 简介</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#pe-%E7%BB%93%E6%9E%84%E6%A6%82%E8%BF%B0"><span class="nav-number">1.2.</span> <span class="nav-text"> PE 结构概述</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E7%AE%A1%E7%90%86%E7%BB%93%E6%9E%84"><span class="nav-number">1.3.</span> <span class="nav-text"> 数据管理结构</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#01-dos-%E5%A4%B4"><span class="nav-number">1.3.1.</span> <span class="nav-text"> 01 DOS 头</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#02-pe-%E5%A4%B4nt-%E5%A4%B4%E7%BB%93%E6%9E%84"><span class="nav-number">1.3.2.</span> <span class="nav-text"> 02 PE 头（NT 头）结构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#03-%E8%8A%82%E8%A1%A8%E5%8C%BA%E5%9D%97%E8%A1%A8"><span class="nav-number">1.3.3.</span> <span class="nav-text"> 03 节表（区块表）</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E9%83%A8%E5%88%86%E5%8C%BA%E5%9D%97%E8%8A%82"><span class="nav-number">1.4.</span> <span class="nav-text"> 数据部分——区块（节）</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">LinJHS</p>
  <div class="site-description" itemprop="description">This is LinJHS's blog</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">20</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/LinJHS" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;LinJHS" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="/rss.xml" title="RSS → &#x2F;rss.xml"><i class="fa fa-rss fa-fw"></i>RSS</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">LinJHS</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

  

<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.css">

<script>
NexT.utils.loadComments(document.querySelector('#gitalk-container'), () => {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID    : '405711ae5b392ea52f22',
      clientSecret: '5581aa0eecaeda7c799784d594209e5e6a061d99',
      repo        : 'LinJHS-Hexo-Comment',
      owner       : 'LinJHS',
      admin       : ['LinJHS'],
      id          : 'fd6620b6b0de38da6f3df0c9e22a9645',
      proxy       : 'https://vercel.prohibitorum.top/github_access_token',
        language: 'zh-CN',
      distractionFreeMode: true
    });
    gitalk.render('gitalk-container');
  }, window.Gitalk);
});
</script>


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'xA7vHfV5hTiT3MD9peshOsKG-gzGzoHsz',
      appKey     : 'B4WKMjiMvcwVyxsVtZW9IMKO',
      placeholder: "本评论系统将会在您发表评论时记录您的 IP ，并且会不定时删除违规评论，感谢您的配合。",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : true,
      lang       : 'zh-cn' || 'zh-cn',
      path       : location.pathname,
      recordIP   : true,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
